!function(ng){ng.module("FirebaseAuth",["firebase"]).provider("$firebaseAuth",function(){"use strict";var FirebaseURL="";this.setUrl=function(url){FirebaseURL=url},this.$get=["$firebase","$firebaseSimpleLogin",function($firebase,$firebaseSimpleLogin){var authService,authUser,$userSync,ref=new Firebase(FirebaseURL),$auth=$firebaseSimpleLogin(ref),normalizer={defaultUser:{name:{first:"",last:"",middle:""},imageUrl:"",email:"",provider:"",provider_id:"",displayName:"",authenticated:!1,authenticating:!1},facebook:function(providerData,user){ng.extend(user,{name:{first:providerData.first_name,last:providerData.last_name,middle:""},imageUrl:providerData.picture.data.url,email:""})},google:function(providerData,user){ng.extend(user,{name:{first:providerData.given_name,last:providerData.family_name,middle:""},imageUrl:providerData.picture,email:providerData.email})},github:function(providerData,user){ng.extend(user,{name:{first:providerData.name.split(" ")[0],last:providerData.name.split(" ")[1]||"",middle:""},imageUrl:providerData.avatar_url,email:providerData.email})},twitter:function(providerData,user){ng.extend(user,{name:{first:providerData.name.split(" ")[0],last:providerData.name.split(" ")[1]||"",middle:""},imageUrl:providerData.profile_image_url,email:""})},normalize:function(providerUser,user){return"function"!=typeof this[providerUser.provider]?(console.log("Unknown provider "+providerUser.provider+". Unable to normalize user"),null):(ng.extend(user,{provider:providerUser.provider,provider_id:providerUser.id,displayName:providerUser.displayName,uid:providerUser.uid}),this[providerUser.provider](providerUser.thirdPartyUserData,user),user)},clense:function(data,obj){obj=obj||this.defaultUser;var cleanData={};for(var k in obj)void 0!==data[k]&&"object"==typeof obj[k]&&"object"==typeof data[k]?cleanData[k]=this.clense(data[k],obj[k]):void 0!==data[k]&&"object"!=typeof data[k]&&(cleanData[k]=data[k]);return cleanData},clear:function(user){return user=user||{},ng.extend(user,this.defaultUser),user.name=ng.extend({},this.defaultUser.name),user}},saveUser=function(){return authUser.uid?$firebase(ref.child("users")).$set(authUser.uid,authUser):void 0},updateUser=function(userData){userData&&(ng.extend(authUser,normalizer.clense(userData)),authUser.authenticated||logout())},processUser=function(providerUser){return providerUser&&providerUser.uid?normalizer.normalize(providerUser,authUser)?(authUser.authenticated=!0,authUser.authenticating=!1,saveUser().then(setupUserRef,logout)):void logout("Unable to normalize: Unknown provider"):(authUser.authenticating=!1,void saveUser())},clearUser=function(){saveUser(),removeUserRef(),normalizer.clear(authUser)},login=function(provider){authUser.authenticating=!0,provider?$auth.$login(provider).then(processUser,logout):$auth.$getCurrentUser().then(processUser,logout)},logout=function(error){authUser.loginError=error||null,authUser.authenticated=!1,clearUser(),$auth.$logout()},removeUserRef=function(){$userSync&&($userSync.$destroy(),$userSync=null)},setupUserRef=function(){removeUserRef(),authUser.uid&&($userSync=$firebase(new Firebase(FirebaseURL+"/users/"+authUser.uid)).$asObject(),$userSync.$watch(function(){updateUser($userSync)}))},getToken=function(){return $auth.user?$auth.user.firebaseAuthToken:void 0};return authUser=normalizer.clear(),authService={login:login,logout:logout,user:authUser,getToken:getToken},login(),authService}]})}(angular);
!function(ng){ng.module("D6App",["ngRoute","firebase"]).value("FirebaseUrl","https://resplendent-inferno-5462.firebaseio.com/D6Powers").config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){"use strict";$routeProvider.when("/",{controller:"HomeCtlr",templateUrl:"/D6App/views/app/home.html"}).when("/login",{templateUrl:"/D6App/views/app/login.html"}).when("/new",{templateUrl:"/D6App/views/app/new.html"}).when("/view/:uid/:id",{templateUrl:"/D6App/views/app/character.html"}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}])}(angular);
!function(ng){ng.module("D6App").factory("D6Attribute",["D6Utils","D6Sock","D6SkillList",function($d6,Sock,SkillList){"use strict";function D6Attribute(attributeName,$attribute){var attribute=this;ng.extend(this,{rank:1,pips:0,name:attributeName,max:5},$attribute),$d6.addD6Property(attribute,"max"),$sock.get({name:attributeName}).then(function($attribute){$d6.addD6Property(attribute,"description",$attribute.description),attribute.skills=new SkillList(attribute,attribute.skills)})}var $sock=new Sock("attributes");return D6Attribute}])}(angular);
!function(ng){ng.module("D6App").factory("D6AttributeList",["D6Utils","D6Sock","D6Attribute",function($d6,Sock,Attribute){"use strict";function AttributeList(attributes){var attributeList=this;ng.forEach(attributes,function(attribute){attributeList[attribute.name]=new Attribute(attribute.name,attribute)})}var getAttributes=function(filter){var $sock=new Sock("attributes");return $sock.get(filter)};return $d6.addD6Property(AttributeList.prototype,"length"),$d6.addD6Property(AttributeList,"getAttributes",getAttributes),AttributeList}])}(angular);
!function(ng){ng.module("D6App").factory("D6Auth",["D6User",function(User){var D6Auth={user:new User};return D6Auth.user.login(),D6Auth}])}(angular);
!function(ng){ng.module("D6App").factory("D6Character",["$q","D6Auth","D6Utils","D6NameGenerator","D6Sock","D6AttributeList",function($q,$auth,$d6,$nameGenerator,Sock,AttributeList){"use strict";function getPromise(character){var promises;return character.id?(character.attributes=new AttributeList(character.attributes),promises={}):promises={name:$nameGenerator.fullName(character.gender).then(function($name){return character.name=$name,character.name}),alias:$nameGenerator.alias(character.gender).then(function($name){return character.alias=$name,character.alias}),occupation:$nameGenerator.occupation().then(function($occupation){return character.occupation=$occupation,character.occupation}),id:character.$sock._uniqueId().then(function(uid){return character.id=uid,character.id}),attributes:AttributeList.getAttributes().then(function(attributes){return character.attributes=new AttributeList(attributes),character.attributes})},$q.all(promises)}function D6Character($character){var character=this;ng.extend(this,{id:null,name:"",alias:"",occupation:"",archetype:"Adventurer",species:"Human",gender:["Male","Female"][Math.round(Math.random())],powerLevel:2,age:Math.round(15*Math.random()+20),height:Math.round(Math.random()+5)+"'"+Math.round(11*Math.random())+'"',weight:Math.round(150*Math.random())+90,fatePoints:0,kaPoints:0,characterPoints:0,bodyPoints:20,physicalDamage:1,movement:10,funds:0,spentPoints:24,attributes:null,powers:[],advantages:[],disadvantages:[],player:{displayName:$auth.user.displayName,uid:$auth.user.uid}},$character),$d6.addD6Properties(this,{revisions:[],"rw:loading":!0,"rw:$sock":new Sock("characters/"+character.player.uid),editable:character.player.uid===$auth.user.uid,"rw:new":void 0===character.created}),getPromise(this).finally(function(){character.loading=!1})}return $d6.addD6Properties(D6Character.prototype,{length:void 0,save:function(){var character=this;return character.loading=!0,character.$sock.save(character).then(function(){return character.loading=!1,character})},remove:function(){var character=this;return character.loading=!0,character.$sock.remove(character).then(function(){return character.loading=!1,character})}}),$d6.addD6Properties(D6Character,{get:function($userId,$characterId){var $sock=new Sock("characters/"+$userId+"/");return $sock.get($characterId).then(function($character){var character=new D6Character($character);return character})}}),D6Character}])}(angular);
!function(ng){ng.module("D6App").factory("D6CharacterList",["D6Auth","D6Utils","D6Sock","D6Character",function($auth,$d6,Sock,Character){"use strict";function CharacterList(userId){userId=userId||$auth.user.uid;var characterList=this;$d6.addD6Properties(this,{$sock:new Sock("characters/"+userId),"rw:loading":!0}),this.$sock.get().then(function($characters){ng.forEach($characters,function($character){characterList[$character.$id]=new Character($character)}),characterList.loading=!1})}return $d6.addD6Properties(CharacterList.prototype,{length:void 0}),CharacterList}])}(angular);
!function(ng){ng.module("D6App").factory("D6NameGenerator",["D6Sock",function(Sock){"use strict";function getRandomName($names,prev){for(var rand=Math.round(Math.random()*($names.length-1)),name=$names[rand].$value||$names[rand];name===prev;)rand=Math.round(Math.random()*($names.length-1)),name=$names[rand].$value||$names[rand];return name}var $sock=new Sock("names"),all=$sock.get().then(function($names){for(var names={},i=0;i<$names.length;i++)names[$names[i].$id]=$names[i];return names}),D6NameGenerator={fullName:function(gender){return gender=-1!==["Male","Female"].indexOf(gender)?gender:"Male",all.then(function($names){return getRandomName($names.full[gender])})},alias:function(gender){return gender=-1!==["Male","Female"].indexOf(gender)?gender:"Male",all.then(function($names){return getRandomName($names.aliases[gender].concat($names.aliases.Both))})},sillyName:function(){return all.then(function($names){var firstName=getRandomName($names.silly),lastName=getRandomName($names.silly,firstName);return firstName+" "+lastName})},occupation:function(){var rand=Math.round(7549*Math.random()),$occupationSock=new Sock("occupations");return $occupationSock.get(rand).then(function($name){return $name.$value})}};return D6NameGenerator}])}(angular);
!function(ng){ng.module("D6App").factory("D6Normalizer",["D6Utils",function($d6){function D6Normalizer($user){this.$user=$user}return D6Normalizer.prototype={facebook:function($providerData){ng.extend(this.$user,{name:{first:$providerData.first_name,last:$providerData.last_name,middle:""},imageUrl:$providerData.picture.data.url,email:""})},google:function($providerData){ng.extend(this.$user,{name:{first:$providerData.given_name,last:$providerData.family_name,middle:""},imageUrl:$providerData.picture,email:$providerData.email})},github:function($providerData){ng.extend(this.$user,{name:{first:$providerData.name.split(" ")[0],last:$providerData.name.split(" ")[1]||"",middle:""},imageUrl:$providerData.avatar_url,email:$providerData.email})},twitter:function($providerData){ng.extend(this.$user,{name:{first:$providerData.name.split(" ")[0],last:$providerData.name.split(" ")[1]||"",middle:""},imageUrl:$providerData.profile_image_url,email:""})},clense:function(data,obj){obj=obj||$d6.clone(this._user);var cleanData={};for(var k in obj)void 0!==data[k]&&"object"==typeof obj[k]&&"object"==typeof data[k]?cleanData[k]=this.clense(data[k],obj[k]):void 0!==data[k]&&"object"!=typeof data[k]&&(cleanData[k]=data[k]);return cleanData},clear:function(){return ng.extend(this.$user,this._user),this.$user},normalize:function($providerData){return"function"!=typeof this[$providerData.provider]?($d6.log.warn("Unable to normalize user: Unknown provider "+$providerData.provider+"."),null):(ng.extend(this.$user,{provider:$providerData.provider,provider_id:$providerData.id,displayName:$providerData.displayName,uid:$providerData.uid}),this[$providerData.provider]($providerData.thirdPartyUserData),this.$user)}},$d6.addD6Properties(D6Normalizer.prototype,{_user:{name:{first:"",last:"",middle:""},uid:"",imageUrl:"",email:"",provider:"",provider_id:"",displayName:"",authenticated:!1,authenticating:!1}}),D6Normalizer}])}(angular);
!function(ng){ng.module("D6App").factory("D6Skill",["D6Utils","D6Sock",function($d6,Sock){"use strict";function D6Skill(attribute,skillName,$skill){var skill=this,$sock=new Sock("attributes/"+attribute.name+"/skills");ng.extend(this,{name:skillName,attribute:attribute.name,rank:0,pips:0},$skill),$d6.addD6Property(skill,"attribute"),$sock.get({name:skillName}).then(function($skill){$d6.addD6Property(skill,"description",$skill.description)})}return D6Skill}])}(angular);
!function(ng){ng.module("D6App").factory("D6SkillList",["$filter","D6Utils","D6Sock","D6Skill",function($filter,$d6,Sock,Skill){"use strict";function SkillList(attribute,skills){var skillList=this;ng.forEach(skills,function(skill){skillList[skill.name]=new Skill(attribute,skill.name,skill)})}var getSkills=function(filter){var $sock=new Sock("attributes");return $sock.get().then(function($attributes){var skills=[];return ng.forEach($attributes,function($attribute){ng.forEach($attribute.skills,function(skill){skills.push(skill)})}),$filter("filter")(skills,filter)})};return $d6.addD6Property(SkillList.prototype,"length"),$d6.addD6Property(SkillList,"getSkills",getSkills),SkillList}])}(angular);
!function(ng){ng.module("D6App").factory("D6Sock",["$firebase","$filter","FirebaseUrl","D6Utils",function($firebase,$filter,firebaseUrl,$d6){"use strict";function cleanObject($object){try{if(ng.isArray($object))for(var i=0;i<$object.length;i++)cleanObject($object[i]);return $d6.addD6Properties($object,{$id:void 0,$priority:void 0}),$object}catch(ex){return $object}}function D6Sock(apiEnd){$d6.addD6Property(this,"$sock",$firebase(new Firebase(firebaseUrl+"/"+apiEnd+"/")))}return D6Sock.prototype={get:function(query,extrapolate){extrapolate=extrapolate===!0;var $sock=this.$sock;return"function"==typeof query&&(query=query()),"string"==typeof query||"number"==typeof query?$firebase($sock.$ref().child(String(query))).$asObject().$loaded().then(function($object){return cleanObject($object)}):$sock.$asArray().$loaded().then(function($array){if(!query&&!extrapolate)return cleanObject($array);var results=$filter("filter")($array,query);if(!extrapolate)return cleanObject(1===results.length?results[0]:results);for(var objects=[],i=0;i<results.length;i++){var $object=$array.$getRecord($array.$keyAt(results[i]));objects.push($object)}return cleanObject(1===objects.length?objects[0]:objects)})},remove:function(object){var id=object.$id||object.id;return id?this.$sock.$remove(id):!1},save:function(object){var id=object.$id||object.id;return(object.new||!object.created)&&(object.new=!1,object.updated=Date.now(),object.created=Date.now()),this.$sock.$set(id,cleanObject(object))},_uniqueId:function(){return this.$sock.$push().then(function(Ref){return Ref.name()})}},D6Sock}])}(angular);
!function(ng){"use strict";ng.module("D6App").factory("D6Tool",[function(){function D6Tool(properties){ng.extend(this,properties)}return D6Tool.prototype={icon:"blocked",name:"Tool",description:"",show:function(){return!0},disable:function(){return!1},use:function(){}},D6Tool}])}(angular);
!function(ng){"use strict";ng.module("D6App").factory("D6Toolbox",["D6Utils","D6Tool",function($d6,Tool){function D6Toolbox(){this.tools=[]}return $d6.addD6Properties(D6Toolbox.prototype,{add:function(tool,index){if(ng.isArray(tool))for(var i=0;i<tool.length;i++)this.add(tool[i],index);else index=index||0,tool instanceof Tool&&-1===this.tools.indexOf(tool)&&this.tools.splice(index,0,tool)},remove:function(tool){if(ng.isArray(tool))for(var i=0;i<tool.length;i++)this.remove(tool[i]);else{var index=this.tools.indexOf(tool);-1!==index&&this.tools.splice(index,1)}},empty:function(){this.tools.splice(0,this.tools.length)}}),new D6Toolbox}])}(angular);
!function(ng){ng.module("D6App").factory("D6User",["$firebaseSimpleLogin","$firebase","D6Utils","D6Normalizer","FirebaseUrl",function($firebaseSimpleLogin,$firebase,$d6,Normalizer,URL){function D6User(){$d6.addD6Properties(this,{normalizer:new Normalizer(this),"rw:$sync":null})}var ref=new Firebase(URL),$auth=$firebaseSimpleLogin(ref),UsersURL=URL+"/users/";return D6User.prototype={authenticating:!1,authenticated:!1,loginError:null},$d6.addD6Properties(D6User.prototype,{login:function(provider){function success($providerData){return $this._process($providerData)}function error(message){return $this.logout(message)}var $this=this;return this.authenticating=!0,provider?$auth.$login(provider).then(success,error):$auth.$getCurrentUser().then(success,error)},logout:function(error){this.loginError=error||null,this.authenticated=!1,this.authenticating=!1,this.save(),this.normalizer.clear(),this._setupSync(),$auth.$logout()},save:function(){return this.$sync?(ng.extend(this.$sync,this),this.$sync.$save()):void 0},_process:function($providerData){return this.authenticating=!1,$providerData&&$providerData.uid?void(this.normalizer.normalize($providerData)?(this.authenticated=!0,this._setupSync(),this.save()):this.logout("Unknown Provider: "+$providerData.provider)):(this.logout("Invalid"),this)},_setupSync:function(){var $this=this;this.$sync&&(this.$sync.$destroy(),this.$sync=null),this.uid&&(this.$sync=$firebase(new Firebase(UsersURL+this.uid)).$asObject(),this.$sync.$watch(function(){$this.$sync&&(ng.extend($this,$this.normalizer.clense($this.$sync)),$this.authenticated||$this.logout())}))},getToken:function(){return $auth.user?$auth.user.firebaseAuthToken:void 0}}),D6User}])}(angular);
!function(ng,$Math,$Object){ng.module("D6App").factory("D6Utils",["$log",function($log){"use strict";function D6GetLength(){return $Object.keys(this).length}function D6Property(object,property,value){var getter,config={enumerable:!1,configurable:!1};return property.match(/rw:/i)&&!property.match(/get:/i)&&(config.writable=!0),property=property.replace(/rw:/i,""),"function"==typeof value&&property.match(/get:/i)?(getter=value,value=void 0,property=property.replace(/get:/i,"")):void 0===value&&void 0!==object[property]&&(value=object[property],delete object[property]),getter?config.get=getter:"length"===property?config.get=D6GetLength:config.value=value,$Object.defineProperty(object,property,config),object}function D6Properties(object,properties){return ng.forEach(properties,function(value,property){D6Property(object,property,value)}),object}function D6GetFromPath(object,fullPath,parents){parents=parents||0;var paths=fullPath.split(".");try{for(var i=0;i<paths.length-parents;i++)object=object[paths[i]]}catch(ex){}return{nextPath:paths[paths.length-parents],paths:paths.splice(paths.length-parents,parents),target:object}}function D6GetFlatPaths(object,preKey){preKey=preKey||"";var paths=[];return ng.forEach(object,function(property,key){key=preKey+"."+key.replace(" ","\\ "),"object"==typeof property?paths=paths.concat(D6GetFlatPaths(property,key)):"function"!=typeof property&&paths.push(key)}),paths}function D6DeepClone(object){function applyProperty(child,property){obj[property]="object"==typeof child?D6DeepClone(child):child}var obj={};return ng.forEach(object,applyProperty),obj}function D6DeepExtend(){function applyProperty(child,property){"object"==typeof child?obj[property]=D6DeepExtend(child):"function"!=typeof child&&(obj[property]=child)}for(var obj=arguments[0],i=1;i<arguments.length;i++)ng.forEach(arguments[i],applyProperty);return obj}function D6Roll(number,explode,previous){previous=previous||0;var result=$Math.round(5*$Math.random())+1;if(number>1)return number-=1,result=D6Roll(number,explode,result+previous);if(6===result&&explode!==!1){var exp=D6Roll(1);result+=exp}return result+previous}var D6Utils={roll:D6Roll,addD6Property:D6Property,addD6Properties:D6Properties,getFlatPaths:D6GetFlatPaths,getFromPath:D6GetFromPath,clone:D6DeepClone,extend:D6DeepExtend,log:{info:$log.info,warn:$log.warn,error:$log.error}};return D6Utils}])}(angular,Math,Object);
!function(ng){ng.module("D6App").directive("d6Adjust",[function(){"use strict";return{restrict:"E",templateUrl:"/D6App/views/ui/adjust.html",transclude:!0,scope:{target:"=d6Scope"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Attribute",[function(){"use strict";return{restrict:"E",controller:"AttributeCtlr",templateUrl:"/D6App/views/character/attribute.html",scope:{attribute:"=d6Scope",controls:"=d6Controls"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6AuthProfile",[function(){"use strict";return{restrict:"E",scope:{user:"=d6Scope"},templateUrl:"/D6App/views/ui/auth-profile.html"}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Character",[function(){"use strict";return{restrict:"E",templateUrl:"/D6App/views/character/character.html",scope:{character:"=d6Scope"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6CharacterSheet",[function(){"use strict";return{restrict:"E",controller:"CharacterCtlr",templateUrl:"/D6App/views/character/character-sheet.html",scope:{characterId:"=d6CharacterId",characterUserId:"=d6UserId"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Description",["$window",function($window){"use strict";function watchDescription($scope,$el){return function(){if($scope.description&&$scope.description.length){var rightSpace=$window.innerWidth-$el[0].offsetLeft,removeClass="d6-description-"+(400>rightSpace?"right":"left"),addClass="d6-description-"+(400>rightSpace?"left":"right");$el.removeClass(removeClass),$el.addClass(addClass),$el.attr("data-description",$scope.description)}else $el.removeAttr("data-description")}}return{restrict:"A",scope:{description:"=d6Description"},link:function($scope,$el){$el.on("mouseover",watchDescription($scope,$el))}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Dialog",[function(){"use strict";return{restrict:"E",templateUrl:"/D6App/views/ui/dialog.html",transclude:!0,scope:{confirmation:"=d6Confirm"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Header",[function(){"use strict";return{restrict:"E",templateUrl:"/D6App/views/ui/header.html",controller:"HeaderCtlr"}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Skill",[function(){"use strict";return{restrict:"E",controller:"SkillCtlr",templateUrl:"/D6App/views/character/skill.html",scope:{skill:"=d6Scope",controls:"=d6Controls"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Toolbox",[function(){"use strict";return{restrict:"E",templateUrl:"/D6App/views/ui/toolbox.html",controller:"ToolboxCtlr"}}])}(angular);
!function(ng){ng.module("D6App").filter("orderOB",[function(){var toArray=function(items){var list=[];return ng.forEach(items,function(item){list.push(item)}),list},getProp=function(object,fieldMap){var prop=object;try{for(var i=0;i<fieldMap.length;i++)prop=prop[fieldMap[i]]}catch(ex){}return prop};return function(items,field,reverse){var filtered=toArray(items),fields=field.split(".");return filtered.sort(function(a,b){return getProp(a,fields)>getProp(b,fields)?1:-1}),reverse&&filtered.reverse(),filtered}}])}(angular);
!function(ng){ng.module("D6App").filter("replace",[function(){function ReplaceFilter(input,find,replace){var regex=new RegExp(find,"g");return input.replace(regex,replace)}return ReplaceFilter}])}(angular);
!function(ng){ng.module("D6App").controller("AppCtlr",["$scope","$location","D6Auth",function($scope,$location,$auth){"use strict";function checkAuth(){$auth.user.authenticated||"/login"===$location.path()?$auth.user.authenticated&&"/login"===$location.path()&&$location.url(lastPath):(lastPath=$location.url(),$location.path("/login"))}function setLastPath(){"/login"!==$location.path()&&(lastPath=$location.url())}var lastPath="/";$scope.$on("$locationChangeSuccess",setLastPath),$scope.$watch("user.authenticated",checkAuth),$scope.$on("$locationChangeStart",checkAuth),$scope.user=$auth.user}])}(angular);
!function(ng){ng.module("D6App").controller("AttributeCtlr",["$scope","D6Utils",function($scope){"use strict";function onChangeRank(newValue){newValue>$scope.attribute.max&&($scope.attribute.rank=$scope.attribute.max,$scope.attribute.pips=0)}function onChangePips(newValue){newValue>3&&($scope.attribute.pips=0,$scope.attribute.rank++),0>newValue&&($scope.attribute.pips=3,$scope.attribute.rank--),$scope.attribute.rank>=$scope.attribute.max&&($scope.attribute.pips=0,$scope.attribute.rank=$scope.attribute.max,$scope.controls.invalid=!0),$scope.attribute.rank<1&&($scope.attribute.rank=1,$scope.attribute.pips=0,$scope.controls.invalid=!0)}$scope.$watch("attribute.rank",onChangeRank),$scope.$watch("attribute.pips",onChangePips)}])}(angular);
!function(ng){ng.module("D6App").controller("CharacterCtlr",["$window","$scope","$q","D6Utils","D6Toolbox","D6Tool","D6Character",function($window,$scope,$q,$d6,$toolbox,Tool,Character){"use strict";function CharacterRevision(path,oldValue,newValue){this.path=path,this.oldValue=oldValue,this.newValue=newValue}function CharacterWatcher(path){this.path=path,this.cancel=$scope.$watch(path,function(newValue,oldValue){if(newValue!==oldValue&&null!==newValue&&null!==oldValue){if($scope.controls.invalid&&($scope.character.revisions.pop(),$scope.controls.revision--),$scope.controls.invalid||$scope.controls.undoing||$scope.controls.redoing||!$scope.controls.editing)return $scope.controls.undoing=!1,$scope.controls.redoing=!1,void($scope.controls.invalid=!1);$scope.controls.revision<$scope.character.revisions.length&&$scope.character.revisions.splice($scope.controls.revision,$scope.character.revisions.length-$scope.controls.revision),$scope.character.revisions.push(new CharacterRevision(path,oldValue,newValue)),$scope.controls.revision++,$scope.controls.changes=!0}})}function unwatchCharacter(){for(;characterWatchers.length;)characterWatchers.pop().cancel()}function applyCharacterWatch(){unwatchCharacter(),ng.forEach($d6.getFlatPaths($scope.character,"character"),function(path){characterWatchers.push(new CharacterWatcher(path))})}function onChangePhysique(newPhysiqueRank){newPhysiqueRank&&!isNaN(newPhysiqueRank)&&($scope.character.bodyPoints=20+$d6.roll(Number(newPhysiqueRank)))}function onChangeLoad(newLoading){$scope.controls.loading=newLoading}function undoChanges(){for(;undo(););$scope.character.revisions.splice(0,$scope.character.revisions.length),$scope.controls.editing=!1,$scope.controls.changes=!1}function undo(){if($scope.controls.revision--,0==$scope.character.revisions.length||$scope.controls.revision<0)return $scope.controls.revision=0,$scope.controls.changes=!1,!1;var revision=$scope.character.revisions[$scope.controls.revision],object=$d6.getFromPath($scope,revision.path,1);return object.target[object.nextPath]=revision.oldValue,$scope.controls.undoing=!0,$scope.controls.changes=$scope.controls.revision?$scope.controls.changes:!1,!0}function redo(){if($scope.controls.revision>=$scope.character.revisions.length)return $scope.controls.revision=$scope.character.revisions.length,!1;var revision=$scope.character.revisions[$scope.controls.revision],object=$d6.getFromPath($scope,revision.path,1);return object.target[object.nextPath]=revision.newValue,$scope.controls.redoing=!0,$scope.controls.changes=!0,$scope.controls.revision++,!0}function removeCharacter(){$scope.character.remove().then(function(){$scope.controls.editing=!1,$scope.controls.changes=!1})}function saveCharacter(){$scope.character.save().then(function(){$scope.controls.changes=!1,$scope.controls.editing=!1,$scope.controls.revision=0,$scope.character.revisions.splice(0,$scope.character.revisions.length)})}function editCharacter(){applyCharacterWatch(),$scope.controls.editing=!0}function closeRemoveDialog(){$scope.controls.confirmations.remove=null}function closeChangeDialog(){$scope.controls.confirmations.changes=null}function generateCharacter(){unwatchCharacter(),$scope.character=new Character,ng.extend($scope.controls,{editing:!1,changes:!1,undoing:!1,redoing:!1,invalid:!1,loading:!0,revision:0})}var characterWatchers=[];$scope.controls={editing:!1,changes:!1,undoing:!1,redoing:!1,invalid:!1,loading:!0,revision:0,confirmations:{remove:null,changes:null}},$scope.characterUserId&&$scope.characterId?Character.get($scope.characterUserId,$scope.characterId).then(function($character){$scope.character=$character,$scope.controls.loading=$scope.character.loading}):($scope.character=new Character,$scope.controls.loading=$scope.character.loading),$scope.$watch("character.attributes.Physique.rank",onChangePhysique),$scope.$watch("character.loading",onChangeLoad),$scope.$watchCollection("character",applyCharacterWatch);var tools=[new Tool({icon:"spinner5",name:"Regenerate",description:"Regenerate Character",show:function(){return $scope.character?$scope.character.new:!1},disable:function(){return $scope.character?!$scope.character.new:!0},use:function(){if($scope.controls.changes){var def=$q.defer();def.promise.then(generateCharacter).finally(closeChangeDialog),$scope.controls.confirmations.changes=def}else generateCharacter()}}),new Tool({icon:"blocked",name:"cancel",description:"Cancel Changes",show:function(){return $scope.controls.editing},use:function(){if($scope.controls.changes){var def=$q.defer();def.promise.then(undoChanges).finally(closeChangeDialog),$scope.controls.confirmations.changes=def}else $scope.controls.editing=!1}}),new Tool({icon:"undo",name:"undo",description:"Undo Change",show:function(){return $scope.controls.changes},disable:function(){return $scope.controls.revision<=0},use:undo}),new Tool({icon:"redo",name:"redo",description:"Redo Change",show:function(){return $scope.controls.changes},disable:function(){return $scope.character?$scope.controls.revision>=$scope.character.revisions.length:!0},use:redo}),new Tool({icon:"disk",name:"save",description:"Save Character",show:function(){return $scope.character?$scope.controls.changes&&$scope.character.editable:!1},use:saveCharacter}),new Tool({icon:"pencil",name:"edit",description:"Edit Character",show:function(){return $scope.character?!$scope.controls.editing&&$scope.character.editable:!1},use:editCharacter}),new Tool({icon:"remove2",name:"delete",description:"Delete Character",show:function(){return $scope.character?$scope.controls.editing&&$scope.character.editable&&!$scope.character.new:!1},use:function(){var def=$q.defer();def.promise.then(removeCharacter).finally(closeRemoveDialog),$scope.controls.confirmations.remove=def}}),new Tool({icon:"print",name:"print",description:"Print Character",use:function(){$window.print()}})];$toolbox.add(tools)}])}(angular);
!function(ng){ng.module("D6App").controller("HeaderCtlr",["$scope","$location",function($scope,$location){"use strict";$scope.path=$location.path()}])}(angular);
!function(ng){ng.module("D6App").controller("HomeCtlr",["$scope","D6CharacterList",function($scope,CharacterList){"use strict";$scope.characters=new CharacterList}])}(angular);
!function(ng){ng.module("D6App").controller("SkillCtlr",["$scope","D6Utils",function($scope){"use strict";function onChangeRank(newValue){0>newValue&&($scope.skill.rank=0,$scope.skill.pips=0,$scope.controls.invalid=!0)}function onChangePips(newValue){newValue>3&&($scope.skill.pips=0,$scope.skill.rank++),0>newValue&&($scope.skill.pips=3,$scope.skill.rank--),$scope.skill.rank<0&&($scope.skill.rank=0,$scope.skill.pips=0,$scope.controls.invalid=!0)}$scope.$watch("skill.rank",onChangeRank),$scope.$watch("skill.pips",onChangePips)}])}(angular);
!function(ng){ng.module("D6App").controller("ToolboxCtlr",["$scope","D6Toolbox",function($scope,$toolbox){"use strict";function emptyToolbox(){$toolbox.empty()}$scope.tools=$toolbox.tools,$scope.$on("$locationChangeSuccess",emptyToolbox)}])}(angular);