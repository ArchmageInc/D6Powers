!function(ng){ng.module("D6App").factory("D6User",["$firebaseSimpleLogin","$firebase","D6Utils","D6Normalizer","FirebaseUrl",function($firebaseSimpleLogin,$firebase,$d6,Normalizer,URL){function D6User(){$d6.addD6Properties(this,{normalizer:new Normalizer(this),"rw:$sync":null})}var ref=new Firebase(URL),$auth=$firebaseSimpleLogin(ref),UsersURL=URL+"/users/";return D6User.prototype={authenticating:!1,authenticated:!1,loginError:null},$d6.addD6Properties(D6User.prototype,{login:function(provider){function success($providerData){return $this._process($providerData)}function error(message){return $this.logout(message)}var $this=this;return this.authenticating=!0,provider?$auth.$login(provider).then(success,error):$auth.$getCurrentUser().then(success,error)},logout:function(error){this.loginError=error||null,this.authenticated=!1,this.authenticating=!1,this.save(),this.normalizer.clear(),this._setupSync(),$auth.$logout()},save:function(){return this.$sync?(ng.extend(this.$sync,this),this.$sync.$save()):void 0},_process:function($providerData){return this.authenticating=!1,$providerData&&$providerData.uid?void(this.normalizer.normalize($providerData)?(this.authenticated=!0,this._setupSync(),this.save()):this.logout("Unknown Provider: "+$providerData.provider)):(this.logout("Invalid"),this)},_setupSync:function(){var $this=this;this.$sync&&(this.$sync.$destroy(),this.$sync=null),this.uid&&(this.$sync=$firebase(new Firebase(UsersURL+this.uid)).$asObject(),this.$sync.$watch(function(){$this.$sync&&(ng.extend($this,$this.normalizer.clense($this.$sync)),$this.authenticated||$this.logout())}))},getToken:function(){return $auth.user?$auth.user.firebaseAuthToken:void 0}}),D6User}])}(angular);