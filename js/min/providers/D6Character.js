!function(ng){ng.module("D6App").factory("D6Character",["$q","D6Auth","D6Utils","D6NameGenerator","D6Sock","D6AttributeList",function($q,$auth,$d6,$nameGenerator,Sock,AttributeList){"use strict";function getPromise(character){var promises;return character.id?(character.attributes=new AttributeList(character.attributes),promises={}):promises={name:$nameGenerator.fullName(character.gender).then(function($name){return character.name=$name,character.name}),alias:$nameGenerator.alias(character.gender).then(function($name){return character.alias=$name,character.alias}),occupation:$nameGenerator.occupation().then(function($occupation){return character.occupation=$occupation,character.occupation}),id:character.$sock._uniqueId().then(function(uid){return character.id=uid,character.id}),attributes:AttributeList.getAttributes().then(function(attributes){return character.attributes=new AttributeList(attributes),character.attributes})},$q.all(promises)}function D6Character($character){var character=this;ng.extend(this,{id:null,name:"",alias:"",occupation:"",archetype:"Adventurer",species:"Human",gender:["Male","Female"][Math.round(Math.random())],powerLevel:2,age:Math.round(15*Math.random()+20),height:Math.round(Math.random()+5)+"'"+Math.round(11*Math.random())+'"',weight:Math.round(150*Math.random())+90,fatePoints:0,kaPoints:0,characterPoints:0,bodyPoints:20,physicalDamage:1,movement:10,funds:0,spentPoints:24,attributes:null,powers:[],advantages:[],disadvantages:[],player:{displayName:$auth.user.displayName,uid:$auth.user.uid}},$character),$d6.addD6Properties(this,{revisions:[],"rw:loading":!0,"rw:$sock":new Sock("characters/"+character.player.uid),editable:character.player.uid===$auth.user.uid,"rw:new":void 0===character.created}),getPromise(this).finally(function(){character.loading=!1})}return $d6.addD6Properties(D6Character.prototype,{length:void 0,save:function(){var character=this;return character.loading=!0,character.$sock.save(character).then(function(){return character.loading=!1,character})},remove:function(){var character=this;return character.loading=!0,character.$sock.remove(character).then(function(){return character.loading=!1,character})}}),$d6.addD6Properties(D6Character,{get:function($userId,$characterId){var $sock=new Sock("characters/"+$userId+"/");return $sock.get($characterId).then(function($character){var character=new D6Character($character);return character})}}),D6Character}])}(angular);