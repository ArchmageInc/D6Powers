!function(ng){ng.module("D6App",["ngRoute","firebase"]).value("FirebaseUrl","https://d6powers.firebaseio.com/").config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){"use strict";$routeProvider.when("/",{controller:"HomeCtlr",templateUrl:"/views/app/home.html"}).when("/login",{templateUrl:"/views/app/login.html"}).when("/new",{controller:"NewCtlr",templateUrl:"/views/app/view.html"}).when("/view/:uid/:id",{controller:"ViewCtlr",templateUrl:"/views/app/view.html"}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}])}(angular);
!function(ng){ng.module("D6App").factory("D6ArchetypeList",["D6Utils","D6Sock",function($d6,Sock){"use strict";function ArchetypeList(){var $this=this,promise=$sock.get().then(function($archetypes){ng.forEach($archetypes,function($archetype){return $this[$archetype.name]=$archetype,$this})});$d6.addD6Properties($this,{loaded:promise})}var $sock=new Sock("archetypes");return $d6.addD6Properties(ArchetypeList.prototype,{length:void 0,getRandom:function(){var $this=this;return $this.loaded.then(function(){var archetype,rand=Math.round(Math.random()*($this.length-1)),i=0;for(var key in $this)if(archetype=$this[key],i++,i>=rand)return archetype})}}),new ArchetypeList}])}(angular);
!function(ng,$Math){ng.module("D6App").factory("D6Attribute",["D6Utils","D6Sock","D6SkillList",function($d6,Sock,SkillList){"use strict";function D6Attribute(attributeName,$attribute){var $this=this;ng.extend(this,{rank:1,pips:0,name:attributeName},$attribute),$d6.addD6Properties($this,{"rw:max":5}),$sock.get({name:attributeName}).then(function($attribute){$d6.addD6Property($this,"description",$attribute.description),$this.skills=new SkillList($this,$this.skills)})}var $sock=new Sock("attributes");return $d6.addD6Properties(D6Attribute.prototype,{adjust:function(adjPips){var newRank,newPips,totalPips;adjPips&&!isNaN(adjPips=parseInt(adjPips))&&(totalPips=$Math.max(0,adjPips+this.pips+4*this.rank),newRank=$Math.min(this.max,$Math.floor(totalPips/4)),newPips=newRank===this.max?0:totalPips%4,this.rank=newRank,this.pips=newPips)}}),D6Attribute}])}(angular,Math);
!function(ng){ng.module("D6App").factory("D6AttributeList",["D6Utils","D6Sock","D6Attribute",function($d6,Sock,Attribute){"use strict";function AttributeList(attributes){var attributeList=this;ng.forEach(attributes,function(attribute){attributeList[attribute.name]=new Attribute(attribute.name,attribute)})}var getAttributes=function(filter){var $sock=new Sock("attributes");return $sock.get(filter)};return $d6.addD6Property(AttributeList.prototype,"length"),$d6.addD6Property(AttributeList,"getAttributes",getAttributes),AttributeList}])}(angular);
!function(ng){ng.module("D6App").factory("D6Auth",["D6User",function(User){var D6Auth={user:new User};return D6Auth.user.login(),D6Auth}])}(angular);
!function(ng,$Math){ng.module("D6App").factory("D6Character",["$q","D6Auth","D6Utils","D6NameGenerator","D6Sock","D6AttributeList","D6ArchetypeList",function($q,$auth,$d6,$nameGenerator,Sock,AttributeList,Archetypes){"use strict";function clearChanges(character){ng.extend(character.controls,{revision:0,changes:!1,loading:!1,editing:!1,redoing:!1,undoing:!1,invalid:!1}),character.addRevision()}function generate(character){var promises={};return character.id?(character.attributes=new AttributeList(character.attributes),clearChanges(character)):(ng.extend(character,{age:$Math.round(15*$Math.random()+20),height:$Math.round($Math.random()+5)+"'"+$Math.round(11*$Math.random())+'"',weight:$Math.round(150*$Math.random())+90,gender:["Male","Female"][$Math.round($Math.random())]}),promises={name:$nameGenerator.fullName(character.gender).then(function($name){return character.name=$name,character.name}),alias:$nameGenerator.alias(character.gender).then(function($name){return character.alias=$name,character.alias}),occupation:$nameGenerator.occupation().then(function($occupation){return character.occupation=$occupation,character.occupation}),id:character.$sock._uniqueId().then(function(uid){return character.id=uid,character.id}),attributes:AttributeList.getAttributes().then(function(attributes){return character.attributes=new AttributeList(attributes),character.attributes}),archetype:Archetypes.getRandom().then(function(archetype){return character.archetype=archetype.name})}),$q.all(promises)}function D6Character($character){var $this=this;ng.extend($this,{id:null,name:"",alias:"",occupation:"",archetype:"",species:"Human",gender:"",powerLevel:2,age:0,height:"0'0",weight:0,fatePoints:0,kaPoints:0,characterPoints:0,bodyPoints:0,physicalDamage:1,movement:10,funds:0,spentPoints:24,attributes:null,powers:[],advantages:[],disadvantages:[],player:{displayName:$auth.user.displayName,uid:$auth.user.uid}},$character),$d6.addD6Properties($this,{controls:{revisions:[],revision:0,changes:!0,loading:!0,editing:!1,redoing:!1,undoing:!1,invalid:!1},"rw:$sock":new Sock("characters/"+$this.player.uid),editable:$this.player.uid===$auth.user.uid,"rw:new":void 0===$this.created}),$this.controls.loading=generate($this).then(function(){return $this.addRevision(),$this}).finally(function(){$this.controls.loading=!1})}return $d6.addD6Properties(D6Character.prototype,{length:void 0,save:function(){var $this=this;return $this.editable?($this.controls.loading=!0,$this.$sock.save($this).then(function(){return clearChanges($this),$this})):void 0},remove:function(){var $this=this;return $this.editable?($this.controls.loading=!0,$this.$sock.remove($this).then(function(){return clearChanges($this),$this})):void 0},regenerate:function(){var $this=this;return $this.editable&&$this.new?($this.controls.loading=!0,$this.id=null,generate($this).then(function(){return clearChanges($this),$this.controls.changes=!0,$this})):void 0},edit:function(){var $this=this;$this.controls.editing=$this.editable&&!$this.editing},undoAll:function(){var $this=this;clearChanges($this),$d6.log.warn("Character Undo All not implemented")},undo:function(){var $this=this,clone=$this.controls.revisions[$this.controls.revision-2];clone&&($this.controls.undoing=!0,$this.controls.revision--,$d6.extend($this,clone))},redo:function(){var $this=this,clone=$this.controls.revisions[$this.controls.revision];clone&&($this.controls.redoing=!0,$this.controls.revision++,$d6.extend($this,clone))},addRevision:function(){var $this=this;return $this.controls.undoing||$this.controls.redoing||!$this.controls.editing?($this.controls.undoing=!1,void($this.controls.redoing=!1)):($this.controls.changes=$this.controls.revision>0,$this.controls.revision<$this.controls.revisions.length&&$this.controls.revisions.splice($this.controls.revision,$this.controls.revisions.length),$this.controls.revisions.push($d6.clone($this)),void($this.controls.revision=$this.controls.revisions.length))}}),$d6.addD6Properties(D6Character,{get:function($userId,$characterId){var $sock=new Sock("characters/"+$userId+"/");return $sock.get($characterId).then(function($character){var character=new D6Character($character);return character})}}),D6Character}])}(angular,Math);
!function(ng){ng.module("D6App").factory("D6CharacterList",["D6Auth","D6Utils","D6Sock","D6Character",function($auth,$d6,Sock,Character){"use strict";function CharacterList(userId){userId=userId||$auth.user.uid;var characterList=this;$d6.addD6Properties(this,{$sock:new Sock("characters/"+userId),"rw:loading":!0}),this.$sock.get().then(function($characters){ng.forEach($characters,function($character){characterList[$character.$id]=new Character($character)}),characterList.loading=!1})}return $d6.addD6Properties(CharacterList.prototype,{length:void 0}),CharacterList}])}(angular);
!function(ng){ng.module("D6App").factory("D6CharacterTools",["$window","$q","D6Tool",function($window,$q,Tool){"use strict";function D6CharacterTools(character,confirmations){this.tools=[new Tool({icon:"print",name:"print",description:"Print Character",show:function(){return!character.controls.editing},use:function(){$window.print()}}),new Tool({icon:"remove2",name:"delete",description:"Delete Character",show:function(){return character.controls.editing&&character.editable},disable:function(){return character.new},use:function(){var def=$q.defer();def.promise.then(function(){character.remove()}).finally(function(){confirmations.remove.confirmation=null}),confirmations.remove.confirmation=def}}),new Tool({icon:"pencil2",name:"edit",description:"Edit Character",show:function(){return!character.controls.editing&&character.editable},use:function(){character.edit()}}),new Tool({icon:"disk",name:"save",description:"Save Character",show:function(){return character.editable},disable:function(){return!character.controls.changes},use:function(){character.save()}}),new Tool({icon:"redo",name:"redo",description:"Redo Change",show:function(){return character.controls.editing},disable:function(){return character.controls.revision>=character.controls.revisions.length},use:function(){character.redo()}}),new Tool({icon:"undo",name:"undo",description:"Undo Change",show:function(){return character.controls.editing},disable:function(){return character.controls.revision<=1},use:function(){character.undo()}}),new Tool({icon:"blocked",name:"cancel",description:"Cancel Changes",show:function(){return character.controls.editing},use:function(){if(character.controls.changes){var def=$q.defer();def.promise.then(function(){character.undoAll()}).finally(function(){confirmations.abort.confirmation=null}),confirmations.abort.confirmation=def}else character.undoAll()}}),new Tool({icon:"spinner5",name:"Regenerate",description:"Regenerate Character",show:function(){return character.new},use:function(){if(character.controls.changes){var def=$q.defer();def.promise.then(function(){character.regenerate()}).finally(function(){confirmations.abort.confirmation=null}),confirmations.abort.confirmation=def}else character.regenerate()}})]}return D6CharacterTools.prototype={tools:[]},D6CharacterTools}])}(angular);
!function(ng){ng.module("D6App").factory("D6NameGenerator",["D6Sock",function(Sock){"use strict";function getRandomName($names,prev){for(var rand=Math.round(Math.random()*($names.length-1)),name=$names[rand].$value||$names[rand];name===prev;)rand=Math.round(Math.random()*($names.length-1)),name=$names[rand].$value||$names[rand];return name}var $sock=new Sock("names"),all=$sock.get().then(function($names){for(var names={},i=0;i<$names.length;i++)names[$names[i].$id]=$names[i];return names}),D6NameGenerator={fullName:function(gender){return gender=-1!==["Male","Female"].indexOf(gender)?gender:"Male",all.then(function($names){return getRandomName($names.full[gender])})},alias:function(gender){return gender=-1!==["Male","Female"].indexOf(gender)?gender:"Male",all.then(function($names){return getRandomName($names.aliases[gender].concat($names.aliases.Both))})},sillyName:function(){return all.then(function($names){var firstName=getRandomName($names.silly),lastName=getRandomName($names.silly,firstName);return firstName+" "+lastName})},occupation:function(){var rand=Math.round(7549*Math.random()),$occupationSock=new Sock("occupations");return $occupationSock.get(rand).then(function($name){return $name.$value})}};return D6NameGenerator}])}(angular);
!function(ng){ng.module("D6App").factory("D6Normalizer",["D6Utils",function($d6){function D6Normalizer($user){this.$user=$user}return D6Normalizer.prototype={facebook:function($providerData){ng.extend(this.$user,{name:{first:$providerData.first_name,last:$providerData.last_name,middle:""},imageUrl:$providerData.picture.data.url,email:""})},google:function($providerData){ng.extend(this.$user,{name:{first:$providerData.given_name,last:$providerData.family_name,middle:""},imageUrl:$providerData.picture,email:$providerData.email})},github:function($providerData){ng.extend(this.$user,{name:{first:$providerData.name.split(" ")[0],last:$providerData.name.split(" ")[1]||"",middle:""},imageUrl:$providerData.avatar_url,email:$providerData.email})},twitter:function($providerData){ng.extend(this.$user,{name:{first:$providerData.name.split(" ")[0],last:$providerData.name.split(" ")[1]||"",middle:""},imageUrl:$providerData.profile_image_url,email:""})},clense:function(data,obj){obj=obj||$d6.clone(this._user);var cleanData={};for(var k in obj)void 0!==data[k]&&"object"==typeof obj[k]&&"object"==typeof data[k]?cleanData[k]=this.clense(data[k],obj[k]):void 0!==data[k]&&"object"!=typeof data[k]&&(cleanData[k]=data[k]);return cleanData},clear:function(){return ng.extend(this.$user,this._user),this.$user},normalize:function($providerData){return"function"!=typeof this[$providerData.provider]?($d6.log.warn("Unable to normalize user: Unknown provider "+$providerData.provider+"."),null):(ng.extend(this.$user,{provider:$providerData.provider,provider_id:$providerData.id,displayName:$providerData.displayName,uid:$providerData.uid}),this[$providerData.provider]($providerData.thirdPartyUserData),this.$user)}},$d6.addD6Properties(D6Normalizer.prototype,{_user:{name:{first:"",last:"",middle:""},uid:"",imageUrl:"",email:"",provider:"",provider_id:"",displayName:"",authenticated:!1,authenticating:!1}}),D6Normalizer}])}(angular);
!function(ng,$Math){ng.module("D6App").factory("D6Skill",["D6Utils","D6Sock",function($d6,Sock){"use strict";function D6Skill(attribute,skillName,$skill){var skill=this,$sock=new Sock("attributes/"+attribute.name+"/skills");ng.extend(this,{name:skillName,attribute:attribute.name,rank:0,pips:0},$skill),$d6.addD6Property(skill,"attribute"),$sock.get({name:skillName}).then(function($skill){$d6.addD6Property(skill,"description",$skill.description)})}return $d6.addD6Properties(D6Skill.prototype,{adjust:function(adjPips){var newRank,newPips,totalPips;adjPips&&!isNaN(adjPips=parseInt(adjPips))&&(totalPips=$Math.max(0,adjPips+this.pips+4*this.rank),newRank=$Math.floor(totalPips/4),newPips=totalPips%4,this.rank=newRank,this.pips=newPips)}}),D6Skill}])}(angular,Math);
!function(ng){ng.module("D6App").factory("D6SkillList",["$filter","D6Utils","D6Sock","D6Skill",function($filter,$d6,Sock,Skill){"use strict";function SkillList(attribute,skills){var skillList=this;ng.forEach(skills,function(skill){skillList[skill.name]=new Skill(attribute,skill.name,skill)})}var getSkills=function(filter){var $sock=new Sock("attributes");return $sock.get().then(function($attributes){var skills=[];return ng.forEach($attributes,function($attribute){ng.forEach($attribute.skills,function(skill){skills.push(skill)})}),$filter("filter")(skills,filter)})};return $d6.addD6Property(SkillList.prototype,"length"),$d6.addD6Property(SkillList,"getSkills",getSkills),SkillList}])}(angular);
!function(ng){ng.module("D6App").factory("D6Sock",["$firebase","$filter","FirebaseUrl","D6Utils",function($firebase,$filter,firebaseUrl,$d6){"use strict";function cleanObject($object){try{if(ng.isArray($object))for(var i=0;i<$object.length;i++)cleanObject($object[i]);return $d6.addD6Properties($object,{"rw:$id":void 0,"rw:$priority":void 0}),$object}catch(ex){return $object}}function D6Sock(apiEnd){$d6.addD6Property(this,"$sock",$firebase(new Firebase(firebaseUrl+"/"+apiEnd+"/")))}return D6Sock.prototype={get:function(query,extrapolate){extrapolate=extrapolate===!0;var $sock=this.$sock;return"function"==typeof query&&(query=query()),"string"==typeof query||"number"==typeof query?$firebase($sock.$ref().child(String(query))).$asObject().$loaded().then(function($object){return cleanObject($object)}):$sock.$asArray().$loaded().then(function($array){if(!query&&!extrapolate)return cleanObject($array);var results=$filter("filter")($array,query);if(!extrapolate)return cleanObject(1===results.length?results[0]:results);for(var objects=[],i=0;i<results.length;i++){var $object=$array.$getRecord($array.$keyAt(results[i]));objects.push($object)}return cleanObject(1===objects.length?objects[0]:objects)})},remove:function(object){var id=object.$id||object.id;return id?this.$sock.$remove(id):!1},save:function(object){var id=object.$id||object.id;return(object.new||!object.created)&&(object.new=!1,object.updated=Date.now(),object.created=Date.now()),this.$sock.$set(id,cleanObject(object))},_uniqueId:function(){return this.$sock.$push().then(function(Ref){return Ref.name()})}},D6Sock}])}(angular);
!function(ng){ng.module("D6App").factory("D6Tool",[function(){"use strict";function D6Tool(properties){ng.extend(this,properties)}return D6Tool.prototype={icon:"blocked",name:"Tool",description:"",show:function(){return!0},disable:function(){return!1},use:function(){}},D6Tool}])}(angular);
!function(ng){ng.module("D6App").factory("D6Toolbox",["D6Utils","D6Tool",function($d6,Tool){"use strict";function D6Toolbox(){var $this=this;this.tools=[new Tool({icon:"menu",name:"Menu",show:function(){return $this.tools.length>1}})],this.open=!1}return $d6.addD6Properties(D6Toolbox.prototype,{add:function(tool){if(ng.isArray(tool))for(var i=0;i<tool.length;i++)this.add(tool[i]);else tool instanceof Tool&&-1===this.tools.indexOf(tool)&&this.tools.push(tool)},remove:function(tool){if(ng.isArray(tool))for(var i=0;i<tool.length;i++)this.remove(tool[i]);else{var index=this.tools.indexOf(tool);-1!==index&&this.tools.splice(index,1)}},empty:function(){this.tools.splice(1,this.tools.length),this.open=!1},toggle:function(){this.open=!this.open},useTool:function(tool){this.toggle(),tool.use()}}),new D6Toolbox}])}(angular);
!function(ng){ng.module("D6App").factory("D6User",["$firebaseSimpleLogin","$firebase","D6Utils","D6Normalizer","FirebaseUrl",function($firebaseSimpleLogin,$firebase,$d6,Normalizer,URL){function D6User(){$d6.addD6Properties(this,{normalizer:new Normalizer(this),"rw:$sync":null})}var ref=new Firebase(URL),$auth=$firebaseSimpleLogin(ref),UsersURL=URL+"/users/";return D6User.prototype={authenticating:!1,authenticated:!1,loginError:null},$d6.addD6Properties(D6User.prototype,{login:function(provider){function success($providerData){return $this._process($providerData)}function error(message){return $this.logout(message)}var $this=this;return this.authenticating=!0,provider?$auth.$login(provider).then(success,error):$auth.$getCurrentUser().then(success,error)},logout:function(error){this.loginError=error||null,this.authenticated=!1,this.authenticating=!1,$auth.user&&(this.save(),this.normalizer.clear(),this._setupSync(),$auth.$logout())},save:function(){return this.$sync?(ng.extend(this.$sync,this),this.$sync.$save()):void 0},_process:function($providerData){return this.authenticating=!1,$providerData&&$providerData.uid?void(this.normalizer.normalize($providerData)?(this.authenticated=!0,this._setupSync(),this.save()):this.logout("Unknown Provider: "+$providerData.provider)):(this.logout("Invalid Data"),this)},_setupSync:function(){var $this=this;this.$sync&&(this.$sync.$destroy(),this.$sync=null),this.uid&&(this.$sync=$firebase(new Firebase(UsersURL+this.uid)).$asObject(),this.$sync.$watch(function(){$this.$sync&&(ng.extend($this,$this.normalizer.clense($this.$sync)),$this.authenticated||$this.logout())}))},getToken:function(){return $auth.user?$auth.user.firebaseAuthToken:void 0}}),D6User}])}(angular);
!function(ng,$Math,$Object){ng.module("D6App").factory("D6Utils",["$log",function($log){"use strict";function D6GetLength(){return $Object.keys(this).length}function D6Property(object,property,value){var getter,config={enumerable:!1,configurable:!1};return property.match(/rw:/i)&&!property.match(/get:/i)&&(config.writable=!0),property=property.replace(/rw:/i,""),"function"==typeof value&&property.match(/get:/i)?(getter=value,value=void 0,property=property.replace(/get:/i,"")):void 0===value&&void 0!==object[property]&&(value=object[property],delete object[property]),getter?config.get=getter:"length"===property?config.get=D6GetLength:config.value=value,$Object.defineProperty(object,property,config),object}function D6Properties(object,properties){return ng.forEach(properties,function(value,property){D6Property(object,property,value)}),object}function D6GetFromPath(object,fullPath,parents){parents=parents||0;var paths=fullPath.split(".");try{for(var i=0;i<paths.length-parents;i++)object=object[paths[i]]}catch(ex){}return{nextPath:paths[paths.length-parents],paths:paths.splice(paths.length-parents,parents),target:object}}function D6GetFlatPaths(object,preKey){preKey=preKey||"";var paths=[];return ng.forEach(object,function(property,key){key=preKey+"."+key.replace(" ","\\ "),"object"==typeof property?paths=paths.concat(D6GetFlatPaths(property,key)):"function"!=typeof property&&paths.push(key)}),paths}function D6DeepClone(object){function applyProperty(child,property){if(ng.isArray(child)){obj[property]=[];for(var i=0;i<child.length;i++)obj[property][i]=D6DeepClone(child[i])}else obj[property]="object"==typeof child?D6DeepClone(child):child}var obj={};if(ng.isArray(object)){obj=[];for(var i=0;i<object.length;i++)obj[i]=D6DeepClone(object[i]);return obj}return"object"==typeof object?(ng.forEach(object,applyProperty),obj):object}function D6DeepExtend(){function applyProperty(child,property){"object"==typeof child&&"object"==typeof obj[property]?D6DeepExtend(obj[property],child):obj[property]=D6DeepClone(child)}for(var obj=arguments[0],i=1;i<arguments.length;i++)ng.forEach(arguments[i],applyProperty);return obj}function Diff(){}function D6Diff(obj1,obj2){var cdiff,diff=new Diff,oldValue=new Diff,newValue=new Diff;return obj1===obj2?diff:(ng.forEach(obj1,function(child,key){obj2&&void 0!==obj2[key]?"object"==typeof child&&"object"!=typeof obj2[key]?(oldValue[key]=D6DeepClone(child),newValue[key]=obj2[key]):"object"!=typeof child&&"object"==typeof obj2[key]?(oldValue[key]=child,newValue[key]=D6DeepClone(obj2[key])):"object"==typeof child&&"object"==typeof obj2[key]?(cdiff=D6Diff(child,obj2[key]),cdiff.oldValue.length&&(oldValue[key]=cdiff.oldValue),cdiff.newValue.length&&(newValue[key]=cdiff.newValue)):child!==obj2[key]&&(oldValue[key]=child,newValue[key]=obj2[key]):oldValue[key]=D6DeepClone(child)}),ng.forEach(obj2,function(child,key){obj1&&void 0!==obj1[key]||(newValue[key]=D6DeepClone(child))}),diff.oldValue=oldValue,diff.newValue=newValue,diff)}function D6Roll(number,explode,previous){previous=previous||0;var result=$Math.round(5*$Math.random())+1;if(number>1)return number-=1,result=D6Roll(number,explode,result+previous);if(6===result&&explode!==!1){var exp=D6Roll(1);result+=exp}return result+previous}D6Property(Diff.prototype,"length");var D6Utils={roll:D6Roll,addD6Property:D6Property,addD6Properties:D6Properties,getFlatPaths:D6GetFlatPaths,getFromPath:D6GetFromPath,clone:D6DeepClone,extend:D6DeepExtend,diff:D6Diff,log:{info:$log.info,warn:$log.warn,error:$log.error}};return D6Utils}])}(angular,Math,Object);
!function(ng){ng.module("D6App").directive("d6Adjust",[function(){"use strict";return{restrict:"E",templateUrl:"/views/ui/adjust.html",transclude:!0,scope:{target:"=d6Scope"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Attribute",[function(){"use strict";return{restrict:"E",controller:"AttributeCtlr",templateUrl:"/views/character/attribute.html",scope:{attribute:"=d6Scope",controls:"=d6Controls"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6AuthProfile",[function(){"use strict";return{restrict:"E",scope:{user:"=d6Scope"},templateUrl:"/views/ui/auth-profile.html"}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Character",[function(){"use strict";return{restrict:"E",templateUrl:"/views/character/character.html",scope:{character:"=d6Scope"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6CharacterSheet",[function(){"use strict";return{restrict:"E",controller:"CharacterCtlr",templateUrl:"/views/character/character-sheet.html",scope:{character:"=d6Scope"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Description",["$window",function($window){"use strict";function watchDescription($scope,$el){return function(){if($scope.description&&$scope.description.length){var right=($el[0].offsetLeft,$window.innerWidth-$el[0].offsetLeft),removeClass="d6-description-"+(400>right?"right":"left"),addClass="d6-description-"+(400>right?"left":"right");$el.removeClass(removeClass),$el.addClass(addClass),$el.attr("data-description",$scope.description)}else $el.removeAttr("data-description")}}return{restrict:"A",scope:{description:"=d6Description"},link:function($scope,$el){watchDescription($scope,$el)(),$el.on("mouseover",watchDescription($scope,$el))}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Dialog",[function(){"use strict";return{restrict:"E",templateUrl:"/views/ui/dialog.html",transclude:!0,scope:{control:"=d6Control"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Header",[function(){"use strict";return{restrict:"E",templateUrl:"/views/ui/header.html",controller:"HeaderCtlr"}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Select",["$filter",function($filter){"use strict";return{restrict:"E",templateUrl:"/views/ui/select.html",transclude:!0,scope:{enabled:"=d6Enabled",options:"=d6Options",model:"=d6Model"},link:function($scope,$el){$scope.$watch("enabled",function(enabled){enabled?$el.removeClass("disabled"):$el.addClass("disabled")}),$scope.$watch("options.length",function(){$scope.groups=$filter("unique")($scope.options,"type")})}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Skill",[function(){"use strict";return{restrict:"E",controller:"SkillCtlr",templateUrl:"/views/character/skill.html",scope:{skill:"=d6Scope",controls:"=d6Controls"}}}])}(angular);
!function(ng){ng.module("D6App").directive("d6Toolbox",[function(){"use strict";return{restrict:"E",templateUrl:"/views/ui/toolbox.html",controller:"ToolboxCtlr",link:function($scope,$el){$scope.$watch("toolbox.open",function(newValue){newValue?$el.addClass("open"):$el.removeClass("open")})}}}])}(angular);
!function(ng){ng.module("D6App").filter("filterOB",[function(){function isMatch(item,filter){var result=!0;return ng.forEach(filter,function(value,key){value&&item[key]!==value&&(result=!1)}),result}function FilterOB(input,filter){var result=[];return ng.forEach(input,function(item){isMatch(item,filter)&&result.push(item)}),result}return FilterOB}])}(angular);
!function(ng){ng.module("D6App").filter("orderOB",[function(){var toArray=function(items){var list=[];return ng.forEach(items,function(item){list.push(item)}),list},getProp=function(object,fieldMap){var prop=object;try{for(var i=0;i<fieldMap.length;i++)prop=prop[fieldMap[i]]}catch(ex){}return prop};return function(items,field,reverse){var filtered=toArray(items),fields=field.split(".");return filtered.sort(function(a,b){return getProp(a,fields)>getProp(b,fields)?1:-1}),reverse&&filtered.reverse(),filtered}}])}(angular);
!function(ng){ng.module("D6App").filter("replace",[function(){function ReplaceFilter(input,find,replace){var regex=new RegExp(find,"g");return input.replace(regex,replace)}return ReplaceFilter}])}(angular);
!function(ng){ng.module("D6App").filter("unique",[function(){function UniqueFilter(input,field){var found=[],result=[];return ng.forEach(input,function(value){-1===found.indexOf(value[field])&&(found.push(value[field]),result.push(value))}),result}return UniqueFilter}])}(angular);
!function(ng){ng.module("D6App").controller("AppCtlr",["$scope","$location","D6Auth",function($scope,$location,$auth){"use strict";function checkAuth(){$auth.user.authenticated||"/login"===$location.path()?$auth.user.authenticated&&"/login"===$location.path()&&$location.url(lastPath):(lastPath=$location.url(),$location.path("/login"))}function setLastPath(){"/login"!==$location.path()&&(lastPath=$location.url())}var lastPath="/";$scope.$on("$locationChangeSuccess",setLastPath),$scope.$watch("user.authenticated",checkAuth),$scope.$on("$locationChangeStart",checkAuth),$scope.user=$auth.user}])}(angular);
!function(ng){ng.module("D6App").controller("AttributeCtlr",["$scope","D6Utils",function($scope){"use strict";function onChangeRank(newValue){newValue>$scope.attribute.max&&($scope.attribute.rank=$scope.attribute.max,$scope.attribute.pips=0)}function onChangePips(newValue){newValue>3&&($scope.attribute.pips=0,$scope.attribute.rank++),0>newValue&&($scope.attribute.pips=3,$scope.attribute.rank--),$scope.attribute.rank>=$scope.attribute.max&&($scope.attribute.pips=0,$scope.attribute.rank=$scope.attribute.max,$scope.controls.invalid=!0),$scope.attribute.rank<1&&($scope.attribute.rank=1,$scope.attribute.pips=0,$scope.controls.invalid=!0)}$scope.$watch("attribute.rank",onChangeRank),$scope.$watch("attribute.pips",onChangePips)}])}(angular);
!function(ng){ng.module("D6App").controller("CharacterCtlr",["$scope","D6Utils","D6ArchetypeList",function($scope,$d6,archetypes){"use strict";function onChangePhysique(newPhysiqueRank,oldPhysiqueRank){oldPhysiqueRank&&newPhysiqueRank&&!isNaN(newPhysiqueRank)&&($scope.character.bodyPoints=20+$d6.roll(Number(newPhysiqueRank)))}function onDigest(){if($scope.character&&$scope.character.controls.editing){var oldCharacter=$scope.character.controls.revisions[$scope.character.controls.revision-1],newCharacter=$d6.clone($scope.character),diff=$d6.diff(oldCharacter,newCharacter);diff.newValue.length&&$scope.character.addRevision()}}function unwatchCharacter(){for(;watchers.length;)watchers.pop()()}var watchers=[];watchers.push($scope.$watch("character.attributes.Physique.rank",onChangePhysique)),watchers.push($scope.$watch(onDigest)),$scope.$on("$destroy",unwatchCharacter),$scope.archetypes=archetypes,$scope.genders={Male:{name:"Male",description:"The one with the boy parts."},Female:{name:"Female",description:"The one with the girl parts."}}}])}(angular);
!function(ng){ng.module("D6App").controller("HeaderCtlr",["$scope","$location",function($scope,$location){"use strict";$scope.path=$location.path()}])}(angular);
!function(ng){ng.module("D6App").controller("HomeCtlr",["$scope","D6CharacterList",function($scope,CharacterList){"use strict";$scope.characters=new CharacterList}])}(angular);
!function(ng){ng.module("D6App").controller("NewCtlr",["$scope","D6Toolbox","D6CharacterTools","D6Character",function($scope,$toolbox,CharacterTools,Character){"use strict";var confirmations={remove:{confirmation:null,description:"Initiated upon removal of character"},abort:{confirmation:null,description:"Initiated upon aborting character changes"}},character=new Character,tools=new CharacterTools(character,confirmations);$toolbox.add(tools.tools),$scope.character=character,$scope.confirmations=confirmations}])}(angular);
!function(ng){ng.module("D6App").controller("SkillCtlr",["$scope","D6Utils",function($scope){"use strict";function onChangeRank(newValue){0>newValue&&($scope.skill.rank=0,$scope.skill.pips=0,$scope.controls.invalid=!0)}function onChangePips(newValue){newValue>3&&($scope.skill.pips=0,$scope.skill.rank++),0>newValue&&($scope.skill.pips=3,$scope.skill.rank--),$scope.skill.rank<0&&($scope.skill.rank=0,$scope.skill.pips=0,$scope.controls.invalid=!0)}$scope.$watch("skill.rank",onChangeRank),$scope.$watch("skill.pips",onChangePips)}])}(angular);
!function(ng){ng.module("D6App").controller("ToolboxCtlr",["$scope","D6Toolbox",function($scope,$toolbox){"use strict";function emptyToolbox(){$toolbox.empty()}$scope.toolbox=$toolbox,$scope.$on("$locationChangeSuccess",emptyToolbox)}])}(angular);
!function(ng){ng.module("D6App").controller("ViewCtlr",["$scope","$routeParams","D6Toolbox","D6CharacterTools","D6Character",function($scope,$routeParams,$toolbox,CharacterTools,Character){"use strict";var confirmations={remove:{confirmation:null,description:"Initiated upon removal of character"},abort:{confirmation:null,description:"Initiated upon aborting character changes"}};Character.get($routeParams.uid,$routeParams.id).then(function(character){$scope.character=character;var tools=new CharacterTools(character,confirmations);$toolbox.add(tools.tools)}),$scope.confirmations=confirmations}])}(angular);